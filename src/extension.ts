import * as vscode from 'vscode';

/**
 * –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∏ –µ–≥–æ –∑–∞–ø—É—Å–∫–µ –≤ VSCode
 * 
 * @param context - –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–π VSCode. –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏,
 *                  –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ –º–µ—Ç–æ–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
 * 
 * @remarks
 * –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ VSCode –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
 * –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Ñ—É–Ω–∫—Ü–∏–∏:
 * 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
 * 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
 * 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
 */
export function activate(context: vscode.ExtensionContext) {
    
    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É 'random-theme.selectRandomTheme' –≤ –ø–∞–ª–∏—Ç—Ä–µ –∫–æ–º–∞–Ω–¥ VSCode
     * 
     * @param commandName - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–∞–Ω–¥—ã
     * @param callback - –§—É–Ω–∫—Ü–∏—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –∫–æ–º–∞–Ω–¥—ã
     * 
     * @returns Disposable –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ—Ç–º–µ–Ω—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥—ã
     */
    let disposable = vscode.commands.registerCommand('random-theme.selectRandomTheme', () => {
        
        const colorThemes = getInstalledColorThemes();

        const randomIndex = Math.floor(Math.random() * colorThemes.length);
        const randomTheme = colorThemes[randomIndex];
        
        /**
         * –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ü–≤–µ—Ç–æ–≤–æ–π —Ç–µ–º—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ VSCode
         * 
         * @param section - –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ('workbench.colorTheme')
         * @param value - –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (ID –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º—ã)
         * @param configurationTarget - –ì–¥–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É (true = –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
         * 
         */
        vscode.workspace.getConfiguration().update('workbench.colorTheme', randomTheme, true);
        
        /**
         * –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–π —Ç–µ–º–µ
         * 
         * @param message - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã
         */
        vscode.window.showInformationMessage(`üé® Applied random theme: ${randomTheme}`);
    });

    /**
     * –î–æ–±–∞–≤–ª—è–µ–º disposable –æ–±—ä–µ–∫—Ç –≤ –ø–æ–¥–ø–∏—Å–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
     * 
     * @remarks
     * –ü—Ä–∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è VSCode –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑–æ–≤–µ—Ç dispose() –Ω–∞ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–∫–∞—Ö,
     * —á—Ç–æ –æ—Å–≤–æ–±–æ–¥–∏—Ç —Ä–µ—Å—É—Ä—Å—ã –∏ –æ—Ç–º–µ–Ω–∏—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∫–æ–º–∞–Ω–¥
     */
    context.subscriptions.push(disposable);
}

/**
 * –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤—ã—Ö —Ç–µ–º –≤ VSCode
 * 
 * @returns –ú–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ —Ü–≤–µ—Ç–æ–≤—ã—Ö —Ç–µ–º
 * 
 * @remarks
 * –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
 * 1. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
 * 2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤–∫–ª–∞–¥–∞ –≤ —Ü–≤–µ—Ç–æ–≤—ã–µ —Ç–µ–º—ã
 * 3. –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ç–µ–º
 */
function getInstalledColorThemes(): string[] {

    const themes: string[] = [];
    
    const extensions = vscode.extensions.all;

    for (const extension of extensions) {

        const contributes = extension.packageJSON?.contributes;
        
        if (contributes?.themes) {

            for (const theme of contributes.themes) {
                if (theme.id && !themes.includes(theme.id)) {
                    themes.push(theme.id);
                }
            }
        }
    }

    return themes;
}